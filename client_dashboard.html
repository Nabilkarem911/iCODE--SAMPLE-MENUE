<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ููุญุฉ ุงูุชุญูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f3f4f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-btn.active { background-color: #fff7ed; color: #ea580c; border-right: 4px solid #ea580c; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-white border-l hidden md:flex flex-col">
        <div class="p-6 text-center border-b">
            <img id="d-logo" src="images/logo.png" class="w-20 h-20 mx-auto rounded-xl mb-2 object-contain border p-1">
            <h2 id="d-name" class="font-bold text-gray-800">...</h2>
        </div>
        <nav class="p-4 space-y-1 flex-1">
            <button onclick="switchTab('products', this)" class="nav-btn active w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 font-bold hover:bg-gray-50"><i class="fa-solid fa-burger"></i> ุงูููุชุฌุงุช</button>
            <button onclick="switchTab('settings', this)" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 font-bold hover:bg-gray-50"><i class="fa-solid fa-gear"></i> ุงูุฅุนุฏุงุฏุงุช</button>
            <button onclick="switchTab('qr', this)" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 font-bold hover:bg-gray-50"><i class="fa-solid fa-qrcode"></i> ุงูุจุงุฑููุฏ</button>
        </nav>
        <div class="p-4">
            <a href="index.html" class="block w-full text-center bg-red-50 text-red-500 py-2 rounded-xl font-bold">ุฎุฑูุฌ</a>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-8 bg-gray-50">
        
        <div id="tab-products" class="tab-content active">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-black">ุงูููุชุฌุงุช ๐</h1>
                <button onclick="document.getElementById('p-modal').style.display='flex'" class="bg-orange-500 text-white px-6 py-2 rounded-xl font-bold hover:bg-orange-600"><i class="fa-solid fa-plus"></i> ููุชุฌ ุฌุฏูุฏ</button>
            </div>
            <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <div id="tab-settings" class="tab-content">
            <h1 class="text-2xl font-black mb-6">ุฅุนุฏุงุฏุงุช ุงููููู โ๏ธ</h1>
            <div class="bg-white p-8 rounded-2xl shadow-sm max-w-2xl space-y-4">
                <div><label class="block font-bold mb-1">ุงุณู ุงููุทุนู</label><input type="text" id="s-name" class="w-full border rounded-xl p-3"></div>
                <div><label class="block font-bold mb-1">ูุงุชุณุงุจ ุงูุทูุจุงุช (966..)</label><input type="text" id="s-phone" class="w-full border rounded-xl p-3"></div>
                <div><label class="block font-bold mb-1">ุฑุงุจุท ุงูููุฌู</label><input type="text" id="s-logo" class="w-full border rounded-xl p-3"></div>
                <div><label class="block font-bold mb-1">ุงูููู ุงูุฑุฆูุณู</label><input type="color" id="s-color" class="w-full h-12 rounded-xl cursor-pointer"></div>
                <button onclick="saveSettings()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold mt-4">ุญูุธ ุงูุชุบููุฑุงุช</button>
            </div>
        </div>

        <div id="tab-qr" class="tab-content">
            <h1 class="text-2xl font-black mb-6">ุงูุจุงุฑููุฏ ๐ฑ</h1>
            <div class="bg-white p-10 rounded-2xl shadow-sm text-center max-w-md mx-auto">
                <img id="qr-img" src="" class="w-48 h-48 mx-auto mb-4 border-2 p-2 rounded-xl">
                <a id="menu-link" href="#" target="_blank" class="text-blue-500 font-bold underline mb-6 block">ูุชุญ ุฑุงุจุท ุงููููู</a>
                <button onclick="window.print()" class="bg-blue-50 text-blue-600 px-6 py-2 rounded-xl font-bold"><i class="fa-solid fa-print"></i> ุทุจุงุนุฉ</button>
            </div>
        </div>

    </main>

    <div id="p-modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl w-full max-w-md relative">
            <button onclick="document.getElementById('p-modal').style.display='none'" class="absolute top-5 right-5 text-gray-400 hover:text-black"><i class="fa-solid fa-times text-xl"></i></button>
            <h3 class="text-xl font-bold mb-4">ุฅุถุงูุฉ ููุชุฌ</h3>
            <div class="space-y-3">
                <input id="prod-name" class="w-full border rounded-xl p-3" placeholder="ุงุณู ุงูููุชุฌ">
                <div class="flex gap-3">
                    <input id="prod-price" type="number" class="w-full border rounded-xl p-3" placeholder="ุงูุณุนุฑ">
                    <select id="prod-cat" class="w-full border rounded-xl p-3"><option>ุนุฑูุถ</option><option>ุฃุทุจุงู</option><option>ุญูุง</option><option>ูุดุฑูุจุงุช</option></select>
                </div>
                <input id="prod-img" class="w-full border rounded-xl p-3" placeholder="ุฑุงุจุท ุงูุตูุฑุฉ">
                <textarea id="prod-desc" class="w-full border rounded-xl p-3" placeholder="ุงููุตู"></textarea>
            </div>
            <button onclick="addProduct()" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold mt-4">ุญูุธ</button>
        </div>
    </div>

    <script type="module">
        import { db, doc, getDoc, updateDoc, arrayUnion } from './firebase-config.js';

        const restId = localStorage.getItem('admin_rest_id');
        if(!restId) window.location.href = "index.html"; // ุญูุงูุฉ

        async function init() {
            const snap = await getDoc(doc(db, "restaurants", restId));
            if(snap.exists()) {
                const data = snap.data();
                
                // Sidebar Info
                document.getElementById('d-name').innerText = data.name;
                document.getElementById('d-logo').src = data.logo;

                // Products
                const grid = document.getElementById('products-grid');
                grid.innerHTML = (data.products || []).map(p => `
                    <div class="bg-white rounded-2xl shadow-sm border overflow-hidden">
                        <img src="${p.image}" class="h-40 w-full object-cover" onerror="this.src='images/logo.png'">
                        <div class="p-4">
                            <div class="flex justify-between font-bold"><h3>${p.name}</h3><span class="text-orange-500">${p.price} ุฑ.ุณ</span></div>
                            <p class="text-xs text-gray-400 mt-1">${p.category}</p>
                        </div>
                    </div>`).join('');

                // Settings Fill
                document.getElementById('s-name').value = data.name;
                document.getElementById('s-phone').value = data.phone;
                document.getElementById('s-logo').value = data.logo;
                document.getElementById('s-color').value = data.themeColor;

                // QR Code
                const link = window.location.origin + window.location.pathname.replace('client_dashboard.html', '') + `menu.html?id=${restId}`;
                document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(link)}`;
                document.getElementById('menu-link').href = link;
            }
        }

        window.addProduct = async () => {
            const p = {
                name: document.getElementById('prod-name').value,
                price: Number(document.getElementById('prod-price').value),
                category: document.getElementById('prod-cat').value,
                image: document.getElementById('prod-img').value || 'images/logo.png',
                description: document.getElementById('prod-desc').value
            };
            await updateDoc(doc(db, "restaurants", restId), { products: arrayUnion(p) });
            alert("โ ุชู ุงูุญูุธ");
            document.getElementById('p-modal').style.display='none';
            init();
        }

        window.saveSettings = async () => {
            await updateDoc(doc(db, "restaurants", restId), {
                name: document.getElementById('s-name').value,
                phone: document.getElementById('s-phone').value,
                logo: document.getElementById('s-logo').value,
                themeColor: document.getElementById('s-color').value
            });
            alert("โ ุชู ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช");
            init();
        }

        window.switchTab = (tab, btn) => {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            btn.classList.add('active');
        }

        init();
    </script>
</body>
</html>
